<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> The Empyrean Saga - Graficos de Avaliação </title>
    <script src = "https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    
    <div style="width: 30%; display: inline-block;">
        <canvas id="chartLivro1"></canvas>
    </div>

    <div style="width: 30%; display: inline-block;">
        <canvas id="chartLivro2"></canvas>
    </div>

    <div style="width: 30%; display: inline-block;">
        <canvas id="chartLivro3"></canvas>
    </div>
    
</body>
</html>
<script>

    const notasLivros = [

    {
    titulo: "Quarta Asa",
    avaliacoes: [5, 5, 3, 4, 5, 4, 4, 5]
    },

    {
    titulo: "Chama de Ferro",
    avaliacoes: [5, 2, 1, 5, 3, 5, 4]
  },

  {
    titulo: "Tempestade de Ônix",
    avaliacoes: [3, 4, 3, 2, 1, 1, 3, 3, 4, 3]
  }

];

function criarGraficoRosca(idCanvas, tituloLivro, avaliacoes) {
  const media = avaliacoes.reduce((soma, avaliacao) => soma + avaliacao, 0) / avaliacoes.length;

  // Array com os possíveis valores de estrelas (de 1 a 5).
  const estrelas = [5, 4, 3, 2, 1];

  // Conta quantas avaliações receberam cada número de estrelas.  Usa map para criar um novo array.
  // Para cada estrela em 'estrelas', ele filtra o array 'avaliacoes' para contar quantas avaliações são iguais àquela estrela.
  const contagemEstrelas = estrelas.map(estrela => avaliacoes.filter(a => a === estrela).length);

  // Dados para o gráfico de rosca: labels (rótulos), e datasets (conjuntos de dados).
  const dadosGrafico = {
    labels: estrelas.map(estrela => estrela + " estrela(s)"), // Rótulos para cada seção do gráfico (ex: "5 estrela(s)")
    datasets: [{
      data: contagemEstrelas, // Dados para cada seção (número de avaliações para cada número de estrelas).
      backgroundColor: [ // Cores para cada seção do gráfico.
        'rgba(255, 99, 132, 0.8)',
        'rgba(54, 162, 235, 0.8)',
        'rgba(255, 206, 86, 0.8)',
        'rgba(75, 192, 192, 0.8)',
        'rgba(153, 102, 255, 0.8)'
      ],
      borderWidth: 1 // Largura da borda das seções.
    }]
  };

  // Configurações do gráfico: tipo, dados e opções.
  const config = {
    type: 'doughnut', // Tipo de gráfico: gráfico de rosca.
    data: dadosGrafico, // Dados do gráfico.
    options: {
      title: {
        display: true, // Mostra o título.
        text: `${tituloLivro} - Média: ${media.toFixed(1)} estrelas` // Texto do título, incluindo o título do livro e a média das avaliações.
      }
    }
  };

  // Cria o gráfico usando a biblioteca Chart.js.
  new Chart(document.getElementById(idCanvas), config); // 'idCanvas' é o ID do elemento <canvas> no HTML.
}

// Itera sobre o array dadosLivros e chama a função criarGraficoRosca para cada livro.
dadosLivros.forEach((livro, index) => {
  criarGraficoRosca(`chartLivro${index + 1}`, livro.titulo, livro.avaliacoes); // Gera IDs dinamicamente: chartLivro1, chartLivro2, chartLivro3.
});

</script>